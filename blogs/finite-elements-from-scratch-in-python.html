<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2025-01-31 Fri 18:05 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Finite Elements From Scratch (in Python)</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Roboto+Serif:ital,opsz,wght@0,8..144,100..900;1,8..144,100..900&display=swap" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="../assets/css/styles.css" />
<script type="module" src="../assets/js/navbar.js"></script>
<base target="_blank">
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="preamble" class="status">
<nav>
    <!-- Checkbox for toggling menu -->
    <input type="checkbox" id="check">
    <!-- Menu icon -->
    <label for="check" class="checkbtn">
      <i class="fas fa-bars"></i>
    </label>
    <!-- Site logo -->
    <label class="logo"><a href="/index.html">Go Van Go</a></label>
    <!-- Navigation links -->
    <ul class="navbar-ul">
      <li><a target="_self" class="active" href="/index.html">Home</a></li>
      <li><a target="_self" href="/about.html">About</a></li>
      <li><a target="_self" href="/blog.html">Blog</a></li>
      <li><a target="_self" href="/contact.html">Contact</a></li>
    </ul>
  </nav>
</div>
<div id="content" class="content">
<h1 class="title">Finite Elements From Scratch (in Python)
<br>
<span class="subtitle">and how to pick the right one for your simulation</span>
</h1>
<p class="date"><i>last update: Jan 30, 2025</i></p>

<div id="three-js-container"></div>
<p class="three-js-caption">
<b>Interactive</b> 3D visualization of a <b>reference tetrahedron</b> for a finite element mesh. <span class="underline"><b>Click and drag</b></span> to move around the mesh.<br>
</p>

<script type="module" src="/assets/js/reference-tetrahedron.js"></script>
<div id="outline-container-orgaa385df" class="outline-2">
<h2 id="orgaa385df">Article Motivation</h2>
<div class="outline-text-2" id="text-orgaa385df">
<blockquote>
<ul class="org-ul">
<li>What is a finite element?<br></li>
<li>How does it relate to a mesh?<br></li>
<li>Which is the right element for my simulation?<br></li>
<li>Code it in python.<br></li>
</ul>
</blockquote>
</div>
</div>
<div id="outline-container-org6a88b19" class="outline-2">
<h2 id="org6a88b19">What is a finite element?</h2>
<div class="outline-text-2" id="text-org6a88b19">
<p>
<b>Note</b>: <i>were talking about specific elements that are used in finite element analysis (FEA), not the finite element method (FEM) as a whole.</i><br>
</p>

<p>
A finite element is a mathematical tool that serves as <b>building block for a numerical simulation</b> that uses the finite element method for its spatial discretization.<br>
</p>

<p>
The rigous mathematical definition is usually taken from <i>The Mathematical Theory of Finite Element Methods</i> by Brenner and Scott [<a href="#citeproc_bib_item_1">1</a>]. Their definition expands on the classic 1978 definition from P. Ciarlet [<a href="#citeproc_bib_item_2">2</a>].<br>
</p>

<div class="emphasis" id="org5b0839c">
<p>
A finite element is a set that contains the following three objects:<br>
</p>
<ol class="org-ol">
<li>A volume, \(\mathcal{K}\),  with a piecewise smooth boundary.<br></li>
<li>A space of basis functions, \(\mathcal{P}\).<br></li>
<li>A set of nodal variables , \(\mathcal{N} = {N_1, N_2, ..., N_k}\).<br></li>
</ol>

</div>

<p>
All three of these are described by <b>sets</b>, hence the curly letters. Honestly, the fact that they are sets doesn't really concern me, because my goal is to code them up, not study their mathematical properties. If you are interested in their mathematical properties, you should note that <b>the nodal variables</b>, \(\mathcal{N}\) <b>form a basis for the dual space of P</b>.<br>
</p>

<div class="extra" id="org81938fc">
<p>
If \(V\) is a vector space over the real numbers \(\mathbb{R}\), the the <i>dual space of V</i>, denoted \(V'\) is the set of all linear functionals that map \(V \rightarrow \mathbb{R}\). This means all functions that can map a vector in \(V\) to a scalar in \(\mathbb{R}\). This includes things like summing all the elements, or finding the mean, or projecting the vector onto an axis.<br>
</p>

<p>
The fact that all the points in \(\mathcal{N}\) form a basis for \(\mathcal{P}\) <br>
</p>

</div>

<p>
I find this to be a bit counterintuitive. I tend to think of elements as structures that contain a <b>set of points or nodes</b>, a <b>volume</b> (often a triangle or tetrahedron in 3D) and a <b>set of basis functions</b>.<br>
</p>
</div>
</div>
<div id="outline-container-org3295190" class="outline-2">
<h2 id="org3295190">What types of finite elements exist?</h2>
<div class="outline-text-2" id="text-org3295190">
<p>
A lot.<br>
</p>

<p>
Check out <a href="https://defelement.org/elements/index.html">DefElement</a> for a alphabetical list of most of them.<br>
</p>
</div>
</div>
<div id="outline-container-org4a8e783" class="outline-2">
<h2 id="org4a8e783">How do I find out which element I need?</h2>
<div class="outline-text-2" id="text-org4a8e783">
<p>
There are some questions you can ask to narrow it down:<br>
</p>
</div>
<div id="outline-container-orgc79eb1f" class="outline-3">
<h3 id="orgc79eb1f">What function space do you need?</h3>
<div class="outline-text-3" id="text-orgc79eb1f">
<p>
Maxwell's equations, for example, require a curl conforming element (the curl of the field has to be continuous). <b>Nédélec</b> elements would be a great first choice.<br>
</p>
</div>
</div>
<div id="outline-container-org0cd65c8" class="outline-3">
<h3 id="org0cd65c8">What type of mesh are you using?</h3>
<div class="outline-text-3" id="text-org0cd65c8">
<p>
A tetrahedral <a href="https://govango.org/blogs/what-is-a-computational-mesh">mesh</a> requires tetrahedral elements. <b>Lagrange</b> elements are a perfect first choice for tetrahedral elements with scalar unknowns.<br>
</p>
</div>
</div>
<div id="outline-container-org3b3128d" class="outline-3">
<h3 id="org3b3128d">Do you need to reduce computational time?</h3>
<div class="outline-text-3" id="text-org3b3128d">
<p>
If you're using a parallelepiped mesh, <b>serendipity</b> elements might be a good starting choice.<br>
</p>

<p>
In my case, I want to simulate ultrasound waves passing through the brain. That's a complex geometry so I want a unstructured tetrahedron mesh. I'm using a linear acoustic wave equation so <b>Lagrange elements</b> will be perfect to start. I can always adapt in the future. Based on this PhD thesis[<a href="#citeproc_bib_item_3">3</a>] I should use 3rd order basis functions for the best bang for my buck.<br>
</p>
</div>
</div>
</div>
<div id="outline-container-orgd40b7b9" class="outline-2">
<h2 id="orgd40b7b9">Python Code</h2>
<div class="outline-text-2" id="text-orgd40b7b9">
<p>
Lets build a <b>3rd order Lagrange element on a tetrahedron</b> in python. I plan to use this code to build simulations using the finite element method (FEM) (specifically the discontinuous Galerkin variation), lets build a class that we can use in a bunch of projects.<br>
</p>

<p>
As we said before, this class should contain a <b>set of points</b> (often called a <b>nodal basis</b>) some <b>basis functions</b> (in this case, 3rd order Lagrange basis functions), an it should be expressed on some <b>volume</b>.<br>
</p>

<div class="emphasis" id="orgaf246cd">
<p>
<i>Do I have to make a separate element for each cell in my mesh?</i><br>
</p>

<p>
No. Typically all the calculations are done on a <b>reference element</b>, and then mapped to each cell in the mesh via a linear <i>affine</i> transformation. Right now we are just going to build that reference element.<br>
</p>

</div>

<p>
<b>Volume</b>: The reference tetrahedron for an unstructured mesh, with vertices at \((0,0,0), (0,1,0), (0,0,1), (1,0,0)\).<br>
</p>

<p>
<b>Nodal basis</b>: there are more options here again, but we'll go with the Gauss-Lobatto-Legendre (GLL) quadrature points. These help reduce the Runge phenomenon.<br>
</p>

<p>
<b>Basis functions</b>: third order Lagrange functions.<br>
</p>

<p>
Later on we'll need to find the derivatives of these Lagrange functions at the quadrature points, so we'll include that as well.<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #81A1C1;">class</span> <span style="color: #8FBCBB;">LagrangeElement</span>:
    <span style="color: #81A1C1;">def</span> <span style="color: #88C0D0;">__init__</span>(<span style="color: #81A1C1;">self</span>):
        <span style="color: #81A1C1;">pass</span>

    <span style="color: #81A1C1;">def</span> <span style="color: #88C0D0;">basis_functions</span>(<span style="color: #81A1C1;">self</span>):
        <span style="color: #81A1C1;">pass</span>

    <span style="color: #81A1C1;">def</span> <span style="color: #88C0D0;">basis_gradients</span>(<span style="color: #81A1C1;">self</span>):
        <span style="color: #81A1C1;">pass</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org513788a" class="outline-2">
<h2 id="org513788a">References</h2>
<div class="outline-text-2" id="text-org513788a">
<style>.csl-left-margin{float: left; padding-right: 0em;}
 .csl-right-inline{margin: 0 0 0 1em;}</style><div class="csl-bib-body">
  <div class="csl-entry"><a id="citeproc_bib_item_1"></a>
    <div class="csl-left-margin">1. </div><div class="csl-right-inline">Brenner SC, Scott LR. <a href="https://doi.org/10.1007/978-0-387-75934-0">The mathematical theory of finite element methods</a>. 3rd ed. Springer New York, NY; 2008. (Texts in applied mathematics; vol. 15). </div>
  </div>
  <div class="csl-entry"><a id="citeproc_bib_item_2"></a>
    <div class="csl-left-margin">2. </div><div class="csl-right-inline">Ciarlet PG. The finite element method for elliptic problems [Internet]. Society for Industrial and Applied Mathematics; 2002. Available from: <a href="https://epubs.siam.org/doi/abs/10.1137/1.9780898719208">https://epubs.siam.org/doi/abs/10.1137/1.9780898719208</a></div>
  </div>
  <div class="csl-entry"><a id="citeproc_bib_item_3"></a>
    <div class="csl-left-margin">3. </div><div class="csl-right-inline">Vandekerckhove S. <a href="https://doi.org/https://kuleuven.limo.libis.be/discovery/search?query=any,contains,LIRIAS1769623&tab=LIRIAS&search_scope=lirias_profile&vid=32KUL_KUL:Lirias&offset=0">Simulation of wave propagation problems for automated characterisation of material parameters</a>. 2016; </div>
  </div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<footer>
   <p>Go Van Go!</p>
   <a href="https://github.com/go-van-go" target="_blank" rel="noopener noreferrer">
     <i class="fa fa-github githubfooter"></i>
   </a>
</footer>
</div>
</body>
</html>
